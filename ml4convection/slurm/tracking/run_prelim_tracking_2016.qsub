#!/usr/bin/bash

#SBATCH --job-name="run_prelim_tracking_2016"
#SBATCH --ntasks=1
#SBATCH --nodes=1
#SBATCH --mem=16G
#SBATCH --partition="normal"
#SBATCH --time=02:00:00
#SBATCH --array=0-365
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --mail-user=ryan.lagerquist@ou.edu
#SBATCH --output=run_prelim_tracking_2016_%A_%a.out

TOP_RADAR_DIR_NAME="/condo/swatwork/ralager/taiwan/radar_data"
TOP_TRACKING_DIR_NAME="${TOP_RADAR_DIR_NAME}/storm_tracking/prelim"

DATE_STRINGS=("20160101" "20160102" "20160103" "20160104" "20160105" "20160106" "20160107" "20160108" "20160109" "20160110" "20160111" "20160112" "20160113" "20160114" "20160115" "20160116" "20160117" "20160118" "20160119" "20160120" "20160121" "20160122" "20160123" "20160124" "20160125" "20160126" "20160127" "20160128" "20160129" "20160130" "20160131" "20160201" "20160202" "20160203" "20160204" "20160205" "20160206" "20160207" "20160208" "20160209" "20160210" "20160211" "20160212" "20160213" "20160214" "20160215" "20160216" "20160217" "20160218" "20160219" "20160220" "20160221" "20160222" "20160223" "20160224" "20160225" "20160226" "20160227" "20160228" "20160229" "20160301" "20160302" "20160303" "20160304" "20160305" "20160306" "20160307" "20160308" "20160309" "20160310" "20160311" "20160312" "20160313" "20160314" "20160315" "20160316" "20160317" "20160318" "20160319" "20160320" "20160321" "20160322" "20160323" "20160324" "20160325" "20160326" "20160327" "20160328" "20160329" "20160330" "20160331" "20160401" "20160402" "20160403" "20160404" "20160405" "20160406" "20160407" "20160408" "20160409" "20160410" "20160411" "20160412" "20160413" "20160414" "20160415" "20160416" "20160417" "20160418" "20160419" "20160420" "20160421" "20160422" "20160423" "20160424" "20160425" "20160426" "20160427" "20160428" "20160429" "20160430" "20160501" "20160502" "20160503" "20160504" "20160505" "20160506" "20160507" "20160508" "20160509" "20160510" "20160511" "20160512" "20160513" "20160514" "20160515" "20160516" "20160517" "20160518" "20160519" "20160520" "20160521" "20160522" "20160523" "20160524" "20160525" "20160526" "20160527" "20160528" "20160529" "20160530" "20160531" "20160601" "20160602" "20160603" "20160604" "20160605" "20160606" "20160607" "20160608" "20160609" "20160610" "20160611" "20160612" "20160613" "20160614" "20160615" "20160616" "20160617" "20160618" "20160619" "20160620" "20160621" "20160622" "20160623" "20160624" "20160625" "20160626" "20160627" "20160628" "20160629" "20160630" "20160701" "20160702" "20160703" "20160704" "20160705" "20160706" "20160707" "20160708" "20160709" "20160710" "20160711" "20160712" "20160713" "20160714" "20160715" "20160716" "20160717" "20160718" "20160719" "20160720" "20160721" "20160722" "20160723" "20160724" "20160725" "20160726" "20160727" "20160728" "20160729" "20160730" "20160731" "20160801" "20160802" "20160803" "20160804" "20160805" "20160806" "20160807" "20160808" "20160809" "20160810" "20160811" "20160812" "20160813" "20160814" "20160815" "20160816" "20160817" "20160818" "20160819" "20160820" "20160821" "20160822" "20160823" "20160824" "20160825" "20160826" "20160827" "20160828" "20160829" "20160830" "20160831" "20160901" "20160902" "20160903" "20160904" "20160905" "20160906" "20160907" "20160908" "20160909" "20160910" "20160911" "20160912" "20160913" "20160914" "20160915" "20160916" "20160917" "20160918" "20160919" "20160920" "20160921" "20160922" "20160923" "20160924" "20160925" "20160926" "20160927" "20160928" "20160929" "20160930" "20161001" "20161002" "20161003" "20161004" "20161005" "20161006" "20161007" "20161008" "20161009" "20161010" "20161011" "20161012" "20161013" "20161014" "20161015" "20161016" "20161017" "20161018" "20161019" "20161020" "20161021" "20161022" "20161023" "20161024" "20161025" "20161026" "20161027" "20161028" "20161029" "20161030" "20161031" "20161101" "20161102" "20161103" "20161104" "20161105" "20161106" "20161107" "20161108" "20161109" "20161110" "20161111" "20161112" "20161113" "20161114" "20161115" "20161116" "20161117" "20161118" "20161119" "20161120" "20161121" "20161122" "20161123" "20161124" "20161125" "20161126" "20161127" "20161128" "20161129" "20161130" "20161201" "20161202" "20161203" "20161204" "20161205" "20161206" "20161207" "20161208" "20161209" "20161210" "20161211" "20161212" "20161213" "20161214" "20161215" "20161216" "20161217" "20161218" "20161219" "20161220" "20161221" "20161222" "20161223" "20161224" "20161225" "20161226" "20161227" "20161228" "20161229" "20161230" "20161231")

this_date_string=${DATE_STRINGS[$SLURM_ARRAY_TASK_ID]}
echo "Array index = ${SLURM_ARRAY_TASK_ID} ... date = ${this_date_string}"

/home/ralager/anaconda3/bin/python3.6 -u "/condo/swatwork/ralager/ml4convection/ml4convection/scripts/run_prelim_tracking.py" \
--input_refl_dir_name="${TOP_RADAR_DIR_NAME}" \
--input_echo_classifn_dir_name="${TOP_RADAR_DIR_NAME}" \
--first_date_string="${this_date_string}" \
--last_date_string="${this_date_string}" \
--critical_refl_dbz=40 \
--min_echo_top_m_asl=4000 \
--min_size_pixels=5 \
--min_intermax_distance_metres=11112 \
--max_velocity_diff_m_s01=30 \
--max_link_distance_m_s01=38.5833333333333 \
--output_tracking_dir_name="${TOP_TRACKING_DIR_NAME}"
